<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  cfengine - some useful examples / or how I learn't about the bomb and tried Puppet instead / salt? | There is IT in Helsinki
</title>
  <link rel="canonical" href="/cfengine-some-useful-examples-or-how-i-learnt-about-the-bomb-and-tried-puppet-instead-salt.html">


  <link rel="stylesheet" href="/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="/theme/css/fontawesome.min.css">
  <link rel="stylesheet" href="/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="/theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="/atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="/it.atom.xml">  
  <meta name="description" content="Building on the initial post about cfengine we're going to try out some things that may actually be useful. My goal would be to make /etc/resolv.conf identical between all the machines. The server setup is the lustre cluster we built in a previous post. In this post you'll …">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="/">
        <img class="img-fluid rounded" src=/images/blog_site_image_small.webp alt="There is IT in Helsinki">
      </a>
    </div>
  <div class="col-sm-8">
    <h1 class="title"><a href="/">There is IT in Helsinki</a></h1>
      <ul class="list-inline">
          <li class="list-inline-item"><a href="/tags/" target="_blank">tags</a></li>
          <li class="list-inline-item"><a href="/categories/" target="_blank">categories</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fab fa-twitter" href="https://twitter.com/martbhell" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fas fa-rss" href="/atom.xml" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-github" href="https://github.com/martbhell" target="_blank"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  cfengine - some useful examples / or how I learn't about the bomb and tried Puppet instead / salt?
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2012-11-11T00:00:00+02:00">
          <i class="fas fa-clock"></i>
          2012-11-11
        </li>
        <li class="list-inline-item">
          <i class="fas fa-folder-open"></i>
          <a href="/category/it.html">it</a>
        </li>
          <li class="list-inline-item">
            <i class="fas fa-tag"></i>
              <a href="/tag/automation.html">#automation</a>,               <a href="/tag/cfe.html">#cfe</a>,               <a href="/tag/cfengine.html">#cfengine</a>,               <a href="/tag/cms.html">#cms</a>,               <a href="/tag/linux.html">#linux</a>,               <a href="/tag/puppet.html">#puppet</a>,               <a href="/tag/resolv.html">#resolv</a>,               <a href="/tag/conf.html">#conf</a>,               <a href="/tag/resolver.html">#resolver</a>,               <a href="/tag/salt.html">#salt</a>,               <a href="/tag/highstate.html">#highstate</a>,               <a href="/tag/script.html">#script</a>,               <a href="/tag/scripting.html">#scripting</a>          </li>
      </ul>
    </header>
    <div class="content">
      <p>Building on the <a href="https://www.guldmyr.com/cfengine-whats-that-all-about/" title="cfengine – what’s that about?">initial post</a> about cfengine we're going to try out some things that may actually be useful.</p>
<p>My goal would be to make /etc/resolv.conf identical between all the machines.</p>
<p>The server setup is the lustre cluster we built in a previous post.</p>
<p>In this post you'll first see two attempts at getting cfengine and then puppet to do my bidding until success was finally accomplished with <a href="https://www.guldmyr.com/cfengine-some-useful-examples-or-how-i-learnt-about-the-bomb-and-tried-puppet-instead-salt/#salt">salt</a>.</p>
<h1 id="cfengine">Cfengine</h1>
<p>Set up name resolution to be identical on all machines.</p>
<p>http://blog.normation.com/2011/03/21/why-we-use-cfengine-file-editing/</p>
<p>Thought about</p>
<p>Make oss1 and client1 not get the same promises.</p>
<p>Perhaps some kind of rule / IF-statement in the promise?</p>
<p>Cfengine feels archaic. Think editing named/bind configs are complicated? They are not even close to setting up basic promises in cfengine.</p>
<h1 id="puppet-">Puppet -&gt;</h1>
<p>http://puppetlabs.com/</p>
<p>http://www.how2centos.com/centos-6-puppet-install/</p>
<p>vi /etc/yum.repos.d/puppet.repo
pdcp -w oss1,client1 /etc/yum.repos.d/puppet.repo /etc/yum.repos.d/puppet.repo</p>
<p>Sign certificates:</p>
<p>puppet cert list
puppet cert sign 
sudo puppet cert sign --all</p>
<p>For puppet there's a dashboard. This sounds interesting. Perhaps I won't have to write these .pp files which at a glancelooks scarily similar to the cfengine promises.</p>
<p>yum install puppet-dashboard mysqld</p>
<p>service start mysqld</p>
<p>set mysqld password</p>
<p>create databases (as in the database.yml file)</p>
<p>after this I didn't get much further... But I did get the web-server up. Although it was quite empty...</p>
<h1 id="salt">salt</h1>
<p><a href="http://docs.saltstack.org/en/latest/topics/installation/fedora.html" title="http://docs.saltstack.org/en/latest/topics/installation/fedora.html">Easy startup instructions</a> here for getting a parallel shell going:</p>
<p>After it's set up you can run a bunch of built-in special commands, see the <a href="http://docs.saltstack.com/en/latest/#salt-in-depth" title="http://docs.saltstack.com/en/latest/#salt-in-depth">help section about modules</a>.</p>
<p>salt '*' sys.doc|less</p>
<p>will give you all the available modules you use :)</p>
<p>Want to use it for configuration management too? Check out the '<a href="http://docs.saltstack.org/en/latest/topics/tutorials/starting_states.html" title="http://docs.saltstack.org/en/latest/topics/tutorials/starting_states.html">states</a>' section.</p>
<p>What looks bad with salt is that it's a quite new (<a href="http://en.wikipedia.org/wiki/Comparison_of_open_source_configuration_management_software#cite_note-43" title="http://en.wikipedia.org/wiki/Comparison_of_open_source_configuration_management_software#cite_note-43">first release in 2011</a>)</p>
<p><em>Salt is a very common word so it makes googling hard. Most hits tend to be about cryptography or cooking.</em></p>
<p>To distribute (once) the resolv.conf do you run this on the admin-server: salt-cp '*' /etc/resolv.conf /etc/resolv.conf</p>
<p>On to <a href="http://docs.saltstack.org/en/latest/topics/tutorials/states_pt1.html" title="http://docs.saltstack.org/en/latest/topics/tutorials/states_pt1.html">states</a> to make sure that the resolv.conf stays the same:</p>
<ol>
<li>uncomment the defaults in the master-file about file_roots and restart the salt-master service</li>
<li>create /srv/salt and ln -s /etc/resolv.conf /srv/salt/resolv.conf</li>
<li>create a /srv/salt/top.sls and a /srv/salt/resolver.sls</li>
</ol>
<p>In top.sls put:</p>
<p>base:
 '*':
   - resolver</p>
<p>In resolver.sls put:</p>
<p>/etc/resolv.conf:
 file:
  - managed
  - source: salt://resolv.conf</p>
<p>Then run: salt '*' salt.highstate</p>
<p>How to get this to run every now and then? Setting up a cronjob works.</p>
<p>Haven't been able to find a built-in function to accomplish this but then again, all I'm doing here is scratching at the surface so it's working and I'm happy :)</p>
    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
    <li class="list-inline-item"><a href="https://wtangy.se">Was There an NHL Game Yesterday?</a></li>
    <li class="list-inline-item"><a href="/tag/resepti">Recipes in Finnish</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>

</body>

</html>