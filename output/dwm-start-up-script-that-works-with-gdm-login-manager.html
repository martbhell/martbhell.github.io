<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  DWM - start up script that works with GDM login manager | There is IT in Helsinki
</title>
  <link rel="canonical" href="/dwm-start-up-script-that-works-with-gdm-login-manager.html">


  <link rel="stylesheet" href="/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="/theme/css/fontawesome.min.css">
  <link rel="stylesheet" href="/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="/theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="/atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="/it.atom.xml">  
  <meta name="description" content="Goal: Be able to exit DWM and get back to the GDM - gnome login manager. To be able to hit MODKEY+SHIFT+Q, exit dwm and get me back to the login manager. Where I can chose another user or window manager. Or if I make a change in dwm â€¦">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="/">
        <img class="img-fluid rounded" src=/images/blog_site_image_small.webp alt="There is IT in Helsinki">
      </a>
    </div>
  <div class="col-sm-8">
    <h1 class="title"><a href="/">There is IT in Helsinki</a></h1>
      <ul class="list-inline">
          <li class="list-inline-item"><a href="/tags/" target="_blank">tags</a></li>
          <li class="list-inline-item"><a href="/categories/" target="_blank">categories</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fab fa-twitter" href="https://twitter.com/martbhell" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fas fa-rss" href="/atom.xml" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-github" href="https://github.com/martbhell" target="_blank"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  DWM - start up script that works with GDM login manager
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2011-03-18T00:00:00+02:00">
          <i class="fas fa-clock"></i>
          2011-03-18
        </li>
        <li class="list-inline-item">
          <i class="fas fa-folder-open"></i>
          <a href="/category/it.html">it</a>
        </li>
          <li class="list-inline-item">
            <i class="fas fa-tag"></i>
              <a href="/tag/dwm.html">#dwm</a>,               <a href="/tag/gdm.html">#gdm</a>,               <a href="/tag/gnome.html">#gnome</a>,               <a href="/tag/linux.html">#linux</a>,               <a href="/tag/rhel.html">#rhel</a>,               <a href="/tag/window.html">#window</a>,               <a href="/tag/manager.html">#manager</a>          </li>
      </ul>
    </header>
    <div class="content">
      <p>Goal: Be able to exit <a href="http://dwm.suckless.org" title="dwm at suckless.org">DWM and</a> get back to the GDM - gnome login manager. To be able to hit MODKEY+SHIFT+Q, exit dwm and get me back to the login manager. Where I can chose another user or window manager. Or if I make a change in dwm and need to re-load it, this would work as well. Before I had to reboot :)</p>
<p>Finally got this working like I want it to - with some help from #suckless on irc.oftc.net. This works for me with RHEL6, GDM --version 2.30.4 and DWM 5.8.2. My problem was that before (you can see how that looked in <a href="https://www.guldmyr.com/dwm-editing-the-bar-to-show-time/" title="dwm not so good">this post</a>) I ran the dwm also in a loop. But this is not necessary. If you want to keep the statusbar updated with some goodies by running a while loop, you only need to run the xsetroot in a while loop.</p>
<p>/usr/share/xsessions/dwm.desktop</p>
<p>Looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="k">[Desktop Entry]</span>
<span class="na">Encoding</span><span class="o">=</span><span class="s">UTF-8</span>
<span class="na">Name</span><span class="o">=</span><span class="s">dwm</span>
<span class="na">Comment</span><span class="o">=</span><span class="s">This session starts dwm</span>
<span class="na">Exec</span><span class="o">=</span><span class="s">/usr/local/bin/dwm-start</span>
<span class="na">Type</span><span class="o">=</span><span class="s">Application</span>
</code></pre></div>

<p>/usr/local/bin/dwm-start</p>
<p>Looks like this (updated on 2011-04-18):</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh </span>
<span class="c1">#not applicable? I do not have this directory in my home dir. </span>
<span class="c1"># --- commands here and before the &quot;while true; do&quot; are run once #xrdb -merge ~/.Xresources #open screensaver (so that gnome-screensaver-command -l works) </span>
/usr/bin/gnome-screensaver<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span><span class="c1">#open pwer manager #exec gnome-power-manager</span>

<span class="c1">#black bg #want this #path to background #/usr/share/backgrounds/abstract/Flow.png </span>

xsetroot<span class="w"> </span>-solid<span class="w"> </span>black

<span class="k">while</span><span class="w"> </span>true<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>
<span class="w">    </span><span class="c1">#battery</span>
<span class="w">    </span><span class="nv">battotal</span><span class="o">=</span><span class="k">$(</span>awk<span class="w"> </span><span class="s1">&#39;/last full capacity/{print $4}&#39;</span><span class="w"> </span>&lt;<span class="w"> </span>/proc/acpi/battery/BAT0/info<span class="k">)</span>
<span class="w">    </span><span class="nv">batfree</span><span class="o">=</span><span class="k">$(</span>awk<span class="w"> </span><span class="s1">&#39;/remaining capacity/{print $3}&#39;</span><span class="w"> </span>&lt;<span class="w"> </span>/proc/acpi/battery/BAT0/state<span class="k">)</span>
<span class="w">    </span><span class="nv">battper</span><span class="o">=</span><span class="k">$((</span><span class="w"> </span><span class="m">100</span><span class="o">*</span><span class="nv">$batfree</span><span class="o">/</span><span class="nv">$battotal</span><span class="w"> </span><span class="k">))</span>
<span class="w">    </span><span class="nv">battery</span><span class="o">=</span><span class="k">$(</span>awk<span class="w"> </span><span class="s1">&#39;/charging state/{print $3}&#39;</span><span class="w"> </span>&lt;<span class="w"> </span>/proc/acpi/battery/BAT0/state<span class="k">)</span>

<span class="w">    </span><span class="c1">#memfreak to get it in MB</span>
<span class="w">    </span><span class="nv">memfreak2</span><span class="o">=</span><span class="k">$(</span>grep<span class="w"> </span>MemFree<span class="w"> </span>/proc/meminfo<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{ print $2 }&#39;</span><span class="k">)</span>
<span class="w">    </span><span class="nv">memfreak</span><span class="o">=</span><span class="k">$((</span><span class="w"> </span><span class="nv">$memfreak2</span><span class="o">/</span><span class="m">1024</span><span class="w"> </span><span class="k">))</span>

<span class="w">    </span><span class="c1">#time</span>
<span class="w">    </span><span class="nv">CLK</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+<span class="s1">&#39;%a %b %d %R:%S %Z&#39;</span><span class="k">)</span>

<span class="w">    </span><span class="c1">#volume</span>
<span class="w">    </span><span class="nv">VOL</span><span class="o">=</span><span class="k">$(</span>amixer<span class="w"> </span>get<span class="w"> </span>Master<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{ print $5 }&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;[]&#39;</span><span class="k">)</span>

<span class="w">    </span><span class="c1">#loadavg</span>
<span class="w">    </span><span class="nv">AVG</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span>/proc/loadavg<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span>-f<span class="w"> </span>-3<span class="k">)</span>

<span class="w">    </span><span class="c1">#network stats in Bytes</span>
<span class="w">    </span><span class="c1">#NW=$(dstat -n --nocolor 1 1 | tail -1 | awk &#39;{ print $1, $2 }&#39;) </span>
<span class="w">    </span><span class="c1">#this one is not so good, increases a delay of 1-2s of the updating.</span>
<span class="w">    </span><span class="c1">#put it in the xsetrootname plz (tip of the day, do not put | as first char after &quot; </span>

<span class="w">    </span>xsetroot<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$AVG</span><span class="s2"> | </span><span class="nv">$memfreak</span><span class="s2"> MB | </span><span class="nv">$battper</span><span class="s2">% </span><span class="nv">$battery</span><span class="s2"> | Vol: </span><span class="nv">$VOL</span><span class="s2"> | </span><span class="nv">$CLK</span><span class="s2"> | &quot;</span>
<span class="w">    </span>sleep<span class="w"> </span><span class="m">1</span>

<span class="c1">#loop is done? :p</span>
</code></pre></div>

<p><code>#traying sleep 1 /usr/bin/ck-launch-session &amp; /usr/local/bin/stalonetray &amp; /usr/bin/nm-applet &amp; /usr/bin/gnome-volume-control-applet &amp; feh -z -Z --bg-scale /home/jguldmyr/Pictures/dwm_pattern.png #feh -z -Z -B black -b trans --bg-scale /home/jguldmyr/Pictures/Flow.png #start dwm after loop exec /usr/local/bin/dwm &gt; /dev/null</code></p>
    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
    <li class="list-inline-item"><a href="https://wtangy.se">Was There an NHL Game Yesterday?</a></li>
    <li class="list-inline-item"><a href="/tag/resepti">Recipes in Finnish</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>

</body>

</html>