<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  AIR-LAP1142N-E-K9 to autonomous Mode Adventure | There is IT in Helsinki
</title>
  <link rel="canonical" href="/air-lap1142n-e-k9-to-autonomous-mode-adventure.html">


  <link rel="stylesheet" href="/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="/theme/css/fontawesome.min.css">
  <link rel="stylesheet" href="/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="/theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="/atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="/it.atom.xml">  
  <meta name="description" content="Some initial needful information Reset is done by holding MODE and then powering off and on the device Default enable password is Cisco Serial ttyUSB0 worked with one usb to rs232 and then a serial to RJ45 adapter, my cheapo ebay USB to rj45 did not work. The colors of …">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="/">
        <img class="img-fluid rounded" src=/images/blog_site_image_small.webp alt="There is IT in Helsinki">
      </a>
    </div>
  <div class="col-sm-8">
    <h1 class="title"><a href="/">There is IT in Helsinki</a></h1>
      <ul class="list-inline">
          <li class="list-inline-item"><a href="/tags/" target="_blank">tags</a></li>
          <li class="list-inline-item"><a href="/categories/" target="_blank">categories</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fab fa-twitter" href="https://twitter.com/martbhell" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fas fa-rss" href="/atom.xml" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-github" href="https://github.com/martbhell" target="_blank"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  AIR-LAP1142N-E-K9 to autonomous Mode Adventure
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2020-02-19T00:00:00+02:00">
          <i class="fas fa-clock"></i>
          2020-02-19
        </li>
        <li class="list-inline-item">
          <i class="fas fa-folder-open"></i>
          <a href="/category/it.html">it</a>
        </li>
          <li class="list-inline-item">
            <i class="fas fa-tag"></i>
              <a href="/tag/aironet.html">#aironet</a>,               <a href="/tag/cisco.html">#cisco</a>,               <a href="/tag/ethernet.html">#ethernet</a>,               <a href="/tag/https.html">#https</a>,               <a href="/tag/ip.html">#ip</a>,               <a href="/tag/lap1142n-e-k9.html">#lap1142n e k9</a>,               <a href="/tag/network.html">#network</a>,               <a href="/tag/vlan.html">#vlan</a>,               <a href="/tag/wifi.html">#wifi</a>,               <a href="/tag/wlan.html">#wlan</a>          </li>
      </ul>
    </header>
    <div class="content">
      <blockquote>
<h2 id="_1"><a href="images/DSC_1469-scaled.jpg"><img alt="Wifi and PoE injector " src="images/DSC_1469-300x225.jpg"></a></h2>
</blockquote>
<h2 id="some-initial-needful-information">Some initial needful information</h2>
<ul>
<li>Reset is done by holding MODE and then powering off and on the device</li>
<li>Default enable password is Cisco</li>
<li>Serial ttyUSB0 worked with one usb to rs232 and then a serial to RJ45 adapter, my cheapo ebay USB to rj45 did not work. The colors of the wires are different..<ul>
<li>working: LL977744 CSA AWM and a "pl2303 converter" Prolific Technology Inc on ttyUSB0</li>
</ul>
</li>
<li>Firmware c1140-k9w7-tar.153-3.JD17.tar found on twitter with checksum d96702caf75442f01359aa9a6cb70d19</li>
</ul>
<p>While the AP is in non autonomous mode you need to run a debug command to get the conf t: <em>debug capwap console cli</em></p>
<p>To change it from using a controller to autonomous mode you need to load a firmware that is like that. The one I got had a firmware loaded that wanted to talk to a controller.</p>
<ul>
<li>While looking in serial log indeed the firmware on the AP was "w8" at the end == needs a WLC</li>
<li>tried to first setup a TFTP server and open firewalls and reboot the access point while holding the mode button (you need to hold it for a long time, like 27s) - it tried to fetch the image from tftp://255.255.255.255/ but didn't work / timed out..</li>
</ul>
<h2 id="hunt-goes-on">Hunt goes on:</h2>
<p>These release notes got me a bit worried: <a href="https://www.cisco.com/c/en/us/td/docs/wireless/access_point/ios/release/notes/aap-rn-83mr5.html">https://www.cisco.com/c/en/us/td/docs/wireless/access_point/ios/release/notes/aap-rn-83mr5.html</a></p>
<p>Conversions from an 8.0 Wireless LAN Controller unified release AP image to autonomous 15.3(3) k9w7 image will get aborted with a message “AP image integrity check failed.” To overcome this, load any previous autonomous k9w7 image and then upgrade to the 15.3(3) JAB k9w7 images. <strong>If this is the same as LWAPP version I had was 7.3.x</strong> <em>so the above did not apply.</em></p>
<p><a href="https://greenwhitehat.blogspot.com/2017/08/how-to-configure-cisco-access-point-air.html">https://greenwhitehat.blogspot.com/2017/08/how-to-configure-cisco-access-point-air.html</a></p>
<p><a href="https://www.fragmentationneeded.net/2010/08/tftp-oddities.html">https://www.fragmentationneeded.net/2010/08/tftp-oddities.html</a> is talking about changing listening address to 255.255.255.255 instead of 0.0.0.0 ..</p>
<h2 id="secret-sauze">secret sauze</h2>
<ul>
<li>setup static IP on your linux computer, <strong><em>make sure to not just "ip addr add ip/24 dev eth0" because you might still have NetworkManager with DHCP that might revert those changes</em></strong></li>
<li>setup a dhcpd that has 10.0.0.5 10.0.0.7 range or some such</li>
<li>setup a linux tftp.service - if you want "--verbose --address 255.255.255.255:69" to the tftp.service CentOS7 edit that file in systemctl cat tftp<ul>
<li>Not sure if needed but maybe it was useful</li>
</ul>
</li>
<li>systemctl start tftp dhcpd</li>
<li>sysetmctl disable dhcpd tftp</li>
<li>make sure to let UDP(&amp; TCP?) 69 through the firewall</li>
<li>next is to connect the console and login to the AP and run some commands:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">$</span><span class="w"> </span><span class="n">ena</span>
<span class="c1"># conf t</span>
<span class="c1"># debug capwap console cli</span>
<span class="c1"># archive download-sw /force-reload /overwrite tftp://10.0.0.2/c1140-k9w7-tar.153-3.JD17.tar</span>
</code></pre></div>

<ul>
<li><em>Before you disconnect the ethernet cable to the AP, do stop and disable dhcpd and tftp to prevent running some extra dhcp server in some office network.</em></li>
</ul>
<h2 id="configuring-it">Configuring it</h2>
<p>Easiest is probably to use the http on http://IP:80 to configure it</p>
<p>Username/Password: Cisco/Cisco</p>
<p><a href="https://www.cisco.com/c/en/us/td/docs/wireless/access_point/1140/autonomous/getting_started/guide/ap1140aut_getstart.html">https://www.cisco.com/c/en/us/td/docs/wireless/access_point/1140/autonomous/getting_starte d/guide/ap1140aut_getstart.html</a></p>
<p>There's the express setup and I used these settings:</p>
<ul>
<li>Only configured the 5GHz</li>
<li>Set a short SSID and enabled broadcast beacon</li>
<li>WPA2-PSK key</li>
<li>Disabled universal admin</li>
<li>Set VLAN 5 and native VLAN</li>
</ul>
<p>Other changes:</p>
<ul>
<li>Enable the radio (no shutdown on the interface or in the web ui)</li>
<li>Create a new user/change default passwords of Cisco user to make it a little bit harder for things to pwn it</li>
<li>Set clock</li>
<li>Change hostname and set a banner login banner</li>
<li>copy run start</li>
</ul>
<p>One could enable https, but that used a too weak key by default so I just left it at http. In any case make sure to set the clock before enabling https.</p>
<h2 id="some-extremely-useful-links">Some extremely useful links</h2>
<p>Previous post in this blog about my home network: <a href="https://www.guldmyr.com/home-network-convergence/">https://www.guldmyr.com/home-network-convergence/</a></p>
<p><a href="https://community.cisco.com/t5/wireless-mobility-documents/lwapp-to-autonomous-conversion-and-vice-versa-on-access-points/ta-p/3121542">https://community.cisco.com/t5/wireless-mobility-documents/lwapp-to-autonomous-conversion-and-vice-versa-on-access-points/ta-p/3121542</a></p>
<p><a href="http://wiki.r1soft.com/display/ServerBackup/Configure+a+TFTP+server+on+Linux">http://wiki.r1soft.com/display/ServerBackup/Configure+a+TFTP+server+on+Linux</a></p>
<p><a href="http://exchange2013pikasuoh.blogspot.com/2015/08/convert-cisco-air-lap1142n-k9-to.html">http://exchange2013pikasuoh.blogspot.com/2015/08/convert-cisco-air-lap1142n-k9-to.html</a></p>
    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
    <li class="list-inline-item"><a href="https://wtangy.se">Was There an NHL Game Yesterday?</a></li>
    <li class="list-inline-item"><a href="/tag/resepti">Recipes in Finnish</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>

</body>

</html>