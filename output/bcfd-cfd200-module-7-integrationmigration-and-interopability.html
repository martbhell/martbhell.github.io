<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  BCFD – CFD200 – Module 7 – Integration/Migration and Interopability | There is IT in Helsinki
</title>
  <link rel="canonical" href="/bcfd-cfd200-module-7-integrationmigration-and-interopability.html">


  <link rel="stylesheet" href="/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="/theme/css/fontawesome.min.css">
  <link rel="stylesheet" href="/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="/theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="/atom.xml">
  
  <meta name="description" content="Fabric migration planning and implementation Why: faster, better scaling (less switches to manage), running out of ports, hardware refresh, new features. Most of the time is spent assessing, determining strategy, development planning and site preparation. Only 20% is for deployment and validation. The first page describes the order as above …">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="/">
        <img class="img-fluid rounded" src=/images/blog_site_image.png alt="There is IT in Helsinki">
      </a>
    </div>
  <div class="col-sm-8">
    <h1 class="title"><a href="/">There is IT in Helsinki</a></h1>
      <ul class="list-inline">
          <li class="list-inline-item"><a href="/tags/" target="_blank">tags</a></li>
          <li class="list-inline-item"><a href="/categories/" target="_blank">categories</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fab fa-twitter" href="https://twitter.com/martbhell" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fas fa-rss" href="/atom.xml" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-github" href="https://github.com/martbhell" target="_blank"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  BCFD – CFD200 – Module 7 – Integration/Migration and Interopability
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2012-01-18T00:00:00+02:00">
          <i class="fas fa-clock"></i>
          2012-01-18
        </li>
        <li class="list-inline-item">
          <i class="fas fa-folder-open"></i>
          <a href="/category/storage.html">storage</a>
        </li>
          <li class="list-inline-item">
            <i class="fas fa-tag"></i>
              <a href="/tag/bcfd.html">#bcfd</a>,               <a href="/tag/bcfp.html">#bcfp</a>,               <a href="/tag/brocade.html">#brocade</a>,               <a href="/tag/certified.html">#certified</a>,               <a href="/tag/fabric.html">#fabric</a>,               <a href="/tag/designer.html">#designer</a>,               <a href="/tag/certification.html">#certification</a>,               <a href="/tag/storage.html">#storage</a>,               <a href="/tag/area.html">#area</a>,               <a href="/tag/network.html">#network</a>          </li>
      </ul>
    </header>
    <div class="content">
      <h1 id="fabric-migration-planning-and-implementation">Fabric migration planning and implementation</h1>
<p>Why: faster, better scaling (less switches to manage), running out of ports, hardware refresh, new features.</p>
<p>Most of the time is spent assessing, determining strategy, development planning and site preparation. Only 20% is for deployment and validation.</p>
<p><strong><em>The first page describes the order as above, but the order in the slides are different with strategies coming after the planning.</em></strong></p>
<h2 id="assessment">Assessment</h2>
<p>Which connections are needed - which hosts and targets need to communicate. Any applications that need to be moved together. Maintenance windows. Coordinate with other groups (servers, disk arrays, OS, services, etc) Compatibility Matrix (HBA model, driver, firmware and FC OS, storage firmware) Risk</p>
<h2 id="plan-development">Plan Development</h2>
<p>Build a plan based on current and future requirements for:</p>
<ul>
<li>Port Count</li>
<li>HA</li>
<li>Power, cooling, space limitations</li>
</ul>
<p>But also current and future technologies like: high bandwidth, server/storage virtualization and improved power/cooling efficiencies. Is the availability of the data center acceptable?</p>
<h2 id="strategies">Strategies</h2>
<p>Most common ones:</p>
<h3 id="replacement-of-existing-switches">Replacement of existing switches</h3>
<h3 id="integration-or-consolidation-of-fabrics">Integration or consolidation of fabrics</h3>
<p>Existing fabrics have new switches added. Hosts and targets are migrated to the new switches over time and eventually old switches are removed. Means new and old switches need to be compatible. Means upgrade firmwares or interopabilitiy modes. But, you can move storage first and then move hosts, you don't have to coordinate downtime for both. One fabric at a time, possibly most disruptive (DID, PID, FOS compatibility). Greater risk. Good because old/existing equipment can be used. No need to redo zoning. Means most effort and most scheduling. Hard to test architecture before implementing it. Loss of B-series features - if interopability mode or too old switches. Hard to schedule downtime for one fabric?</p>
<h4 id="merge-fabric-considerations">Merge Fabric Considerations</h4>
<p>Before merging check for: Duplicate DID, incompatible fabric.ops, zoning mismatch, SCC policies.</p>
<h3 id="dual-fabrics-rip-and-replace">Dual fabrics (rip-and-replace)</h3>
<p>Two new fabrics are created (not merged, so re-create zoning db). New hosts are moved over time. Means having devices on more fabrics (four) at the same time, especially for hosts with only two host ports this limits redundancy and possibly bandwidth reduction for targets. Might be necessary to move hosts and targets at the same time. No compatibility concerns between switches. Needs careful planning. Can test before deploying. Less planning needed. Cables moved more often. More power / cooling requirements. Changes might be required on hosts when storage moves.</p>
<h3 id="dual-fabrics-and-fc-routing">Dual fabrics and FC routing</h3>
<p>Same as dual fabrics, but you can then use routing to interconnect devices during the transition period. Meaning you don't have to move hosts and targets at the same time.</p>
<p>No interopability needed, fabrics are kept isolated. During transition the devices can access eachother via IFLs. NSPOF. Works for hosts with single HBA. Reduce maintenance window? Might still need to change some hosts when storage moves. Best and with less impact. Can roll back if it doesn't work.</p>
<p>Use two routers for redundancy. LSAN zoning used to connect hosts between fabrics. This is also a way to migrate data off arrays.</p>
<h4 id="migration-steps">Migration Steps</h4>
<ol>
<li>Create two new fabrics</li>
<li>Configure EX_Ports</li>
<li>Attach routers to old and new fabrics</li>
<li>Verify connectivity</li>
<li>Create LSANs in old and new fabrics</li>
<li>Move host cables from old fabric to the new one</li>
<li>Verify connectivity</li>
<li>Repeat per fabric and for rest of storage and hosts</li>
<li>Remove routers</li>
</ol>
<h4 id="verify-devices-after-they-are-moved">verify devices after they are moved</h4>
<p>migrate one device at a time, after it's migrated confirm connectivity with 'nsshow, fcrproxydevshow, fcrphydevshow'. Record and track FID, PID and WWN. lsanshow -s.</p>
<h1 id="interopability-between-b-and-m-series-san">Interopability between B- and M-series SAN</h1>
<p>M- to B-Series migration: for non-disruptive migration redundant fabrics are required. New FOS fabric should also be redundant. Postmigration you will have two SANs of identical topology. Using routers and the 'dual fabrics'.</p>
<p>Setting up a whole new SAN is good because you don't have to mess with interopability.</p>
<p><a href="http://community.brocade.com/docs/DOC-1639" title="more details about IM">Domain ID offset</a> - is used in interopmode by default and makes the DID range from 1-31 or 97-127</p>
<p>The document above says "<strong>Chapter 4 - Interop-Mode is Obsolete in FOS 7</strong> Since Brocade announce and released as GA Fabric Operating System Release 7.x, Interop-Mode is not longer in use."</p>
<p>In the FOS 7.x admin guide it says <strong>that the only way to mix FOS and M-EOS is via an FC Router.</strong> Portcfgexport PORT -m "interopmode"</p>
<p>FOS 7.x a switch has to be in interopmode 0.</p>
<p>When you do routing between a B- and M-series the FD DID needs to be in the range of the M-EOS fabric (DID offset).</p>
<h1 id="considerations-when-migration-from-4g-to-8g">Considerations when migration from 4G to 8G</h1>
<p>Why: new features and more credits/channels/ports per ASIC. More bandwidth in the ISL ("optimum use of fabric resources"). If your SAN is high performing, you can implement services with both high and lower performance requirements.</p>
<h2 id="put-dcx-in-core">Put DCX in Core</h2>
<p>Put DCX in Core and move 48k to the edge. Higher speed and denser core. 8G ISL are possible with 8G blades in the 48k, so 8G blades for ISL and keep the 4G for ports. FC10-6 could be used, but no trunking. On the 8G blades you could put hosts and storage on the same blade - local switching - means more chassi-backplane bandwidth available for other stuff.</p>
<h2 id="npiv">NPIV</h2>
<p>Could increase need for high-speed capability in the SAN (well, better usage on a per server basis). A single server could exceed 4Gbps.</p>
<h1 id="migrating-from-low-port-count-switches-to-directors">Migrating from low port count switches to directors</h1>
<p>structured - time phased integration manageable - interopable migration</p>
<h2 id="technology-refresh">technology refresh</h2>
<p>- amount of ports - amount of rack space</p>
<p>Is there a single director that can accomodate all the ports? Replace existing hardware. Maybe that single director by itself is smaller (less U). No ISL, no oversubscription etc. If there are more ports, consider ICL. Nohops = nice.</p>
<h2 id="fabric-expansion">fabric expansion</h2>
<p>you have to switches that are connected, you are running out of ports. put a DCX in the middle</p>
<h1 id="interopability-modes">Interopability modes</h1>
<p>Interop 0: Brocade Native. Interop 2: McData - M-EOS 9.6.2+ in <strong>Fabric Mode</strong> Interop 3: McData - M-EOS 9.6.2+ in <strong>Open Fabric Mode</strong></p>
<p>0: default on brocade. Most features. Should always be set in pure Brocade environments. 2: can zone from both B- and M-series. Most FOS features. Good for adding B-switches to an M-series SAN. Cannot work with interop mode 1 (FOS 5.x). Supports FICON. 3: zoning done on M-series. Some features not available. Good for adding B-series switches. Not OK with interop 1. Only B- and M-series, nobody else.</p>
<p>Worry about:</p>
<ul>
<li>does the hardware support this</li>
<li>any features unsupported</li>
<li>restrictions for configuration</li>
<li>upgrade/downgrade</li>
<li>zone management</li>
<li>moving from B- to M-series.</li>
</ul>
<p>Basically you're not missing anything vital in interopmode, only special features. In IM3: FICON, TI Zones, Frame Redirection and SCC policies. Both miss out on: DCC policies, broadcast zoning, APM - top talkers, QoS, IRL, Alias Server, "Domain Offset"</p>
<p>Port and Exchange based can be mixed freely between any mode and B- or M-series.</p>
<h2 id="zoning">Zoning</h2>
<p>IM3: only zone on WWpN. FOS zone confdigs are not supported IM2: WWpN and D,I zoning. No port number greater than 255, on any switch in the fabric, neither in fabric or in CLI/WebTOols. Safe Zoning must be disabled after joining.</p>
<p>FOS switches have 3 zoning databases:</p>
<p><strong>transaction</strong> -  work area (cfgtransabort to abort)</p>
<p><strong>defined</strong> - saved (cfgsave). Does not push to other switches.</p>
<p><strong>effective</strong> - enabled (cfgenable). Does not push defined config.</p>
<p>There are limitations when in the IM modes:</p>
<p>FOS 6.1.x and higher -&gt; IM2/3: 2048 devices and 31 DIDs</p>
    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
    <li class="list-inline-item"><a href="https://wtangy.se">Was There an NHL Game Yesterday?</a></li>
    <li class="list-inline-item"><a href="/tag/resepti">Recipes in Finnish</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>

</body>

</html>