<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>"BCvRE - Brocade Certified virtual Router Engineer"</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="There is IT in Helsinki Atom Feed" />
        <meta name="description" content="Been checking out the Vyatta vRouter a bit closer. Mostly because of the BCvRE exam but I'm slowly starting to think there might be some benefits..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">There is IT in Helsinki</a></h1>
                <nav><ul>
                    <li><a href="/category/finland.html">finland</a></li>
                    <li class="active"><a href="/category/it.html">it</a></li>
                    <li><a href="/category/storage.html">storage</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/bcvre-brocade-certified-virtual-router-engineer.html" rel="bookmark"
           title="Permalink to "BCvRE - Brocade Certified virtual Router Engineer"">"BCvRE - Brocade Certified virtual Router Engineer"</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-09-08T00:00:00+03:00">
                Published: "2013-09-08"
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/johan-guldmyr.html">Johan Guldmyr</a>
        </address>
<p>In <a href="/category/it.html">it</a>.</p>
<p>tags: <a href="/tag/bcvre.html">bcvre</a> <a href="/tag/brocade.html">brocade</a> <a href="/tag/certified.html">certified</a> <a href="/tag/exam.html">exam</a> <a href="/tag/open.html">open</a> <a href="/tag/source.html">source</a> <a href="/tag/virtualization.html">virtualization</a> </p>
</footer><!-- /.post-info -->      <p>Been checking out the Vyatta vRouter a bit closer. Mostly because of the BCvRE exam but I'm slowly starting to think there might be some benefits to using it elsewhere too.</p>
<ol>
<li>See <a href="http://www.guldmyr.com/blog/vyatta-a-routervpnfirewall-in-a-vm-brocade-certified-vrouter-engineer/">vyatta-a-routervpnfirewall-in-a-vm-brocade-certified-vrouter-engineer/</a> for where to find manuals or training materials.</li>
<li>See <a href="http://www.guldmyr.com/blog/?p=2041">the objectives</a>.</li>
</ol>
<p>I tried installing <a href="http://vyatta.com/" title="http://vyatta.com/">Vyatta</a> vRouter 6.6 amd64 Live ISO to disk first in a Virtualbox VDI file and then uploading said file to openstack. This works, but:</p>
<p>Ethernet interfaces might get renamed but a startup, log in and save, poweroff and another boot should get the first interface back to eth0.</p>
<p>In the openstack available to me I could set up my own networking topology like this:</p>
<ul>
<li>Create one network (VLAN) and define several subnets inside (these are still kind of firewalled based on IP and MACs).</li>
<li>Then create machines and add the network.</li>
<li>Power off and start the machines again (or the links stay DOWN).</li>
</ul>
<p>VMs should see an individual eth interface per subnet. The machines still get an IP assigned to each interface/subnet even if DHCP is disabled. If DHCP is disabled you still have to statically assign only this assigned address on the interface. The interfaces are in order: the IP listed at the top is the IP you need to put on the first interface (eth0).</p>
<p>Because a lot of the things you can do with a router involves creating networks and assigning IP addresses, which openstack would block for security reasons - it was much easier to do all of these in VMWare Workstation:</p>
<h2><strong>DHCP/DNS</strong></h2>
<ol>
<li>Install a Vyatta VM - bridged and a private network (without a DHCP).</li>
<li>Install another OS in a VM - this will be a client - only on the private network.</li>
<li>Put both VMs in the same network.</li>
<li>Configure dhcp on the Vyatta VM:</li>
</ol>
<p>configure
delete interfaces ethernet eth1 address dhcp 
set interfaces ethernet eth1 address 10.1.1.1/24
commit</p>
<p>Configure dhcpd on the Vyatta VM:</p>
<p>configure
set service dhcp-server
set service dhcp-server shared-network-name ETH1_POOL subnet ??? # pool, dns, router</p>
<p>Then, set up so that the Vyatta VM routes traffic from the private network to the Internets. A NAT. This is called a source NAT in the vyatta CLI.</p>
<p>set nat source rule 10 ??? # Put in the settings you need. Source, outbound interface and the IP they should be seen as from the outside.</p>
<p>Real easy to set up a DNS forwarding server too:</p>
<p>set service dns forwarding listen-on eth1 
set service dns forwarding name-server 8.8.8.8
commit</p>
<p>Now we have a client behind the Vyatta gateway that can access the Internet!</p>
<p>It's possible to set up different kinds of VPNs. For example site-to-site or remote access.</p>
<p>It is possible to ssh from the vyatta VM - you can even run ssh-keygen. How to add an authorized key you wonder?:</p>
<p>set system login user vyatta authentication ...</p>
<h2>Routing</h2>
<p>Another thing to test: launch a bunch of Vyatta VM and use them to route IP traffic, woop woop! The BCvRE objectives actually mention OSPF so this would be wise to test.</p>
<h3>Starting with static routing</h3>
<p><em>Key: Network Name (IP subnet, interface on the host)</em></p>
<ul>
<li><em>VM hostname - Interface inside the VM: IP address</em></li>
</ul>
<p>Topology:</p>
<p>Public (192.168.1.0/24, bridged):</p>
<ul>
<li>Vyatta - eth0: 192.168.0.23</li>
</ul>
<p>Network A (10.1.1.0/24, vmnet2):</p>
<ul>
<li>Vyatta - eth1: 10.1.1.1</li>
<li>V1 - eth0: 10.1.1.10</li>
<li>V2 - eth1: 10.1.1.20</li>
</ul>
<p>Nework B (10.2.2.0/24 , vmnet3):</p>
<ul>
<li>V2 - eth2: 10.2.2.20</li>
<li>V3 - eth0: 10.2.2.30</li>
</ul>
<p>Static routing:</p>
<p>Vyatta: set protocol static 10.2.2.0/24 next-hop 10.1.1.20
V1: set protocol static 10.2.2.0/24 next-hop 10.1.1.20
V3: set protocol static 10.1.1.0/24 next-hop 10.2.2.20
V3: ping 10.1.1.10</p>
<h3>OSPF!</h3>
<p>Adding host V4 that is in Network B and Network C. Basically Vyatta, V2 and V4 are routers. V1 and V3 do not run OSPF, they have their default gateway to one of their local routers. So V3 has 10.2.2.20 and V1 has 10.1.1.1.</p>
<p>Public (192.168.1.0/24, bridged):</p>
<ul>
<li>Vyatta - eth0: 192.168.0.23</li>
</ul>
<p>Network A (10.1.1.0/24, vmnet2):</p>
<ul>
<li>Vyatta - eth1: 10.1.1.1</li>
<li>V1 - eth0: 10.1.1.10</li>
<li>V2 - eth1: 10.1.1.20</li>
</ul>
<p>Network B: (10.2.2.0/24, vmnet3)</p>
<ul>
<li>V2 - eth2: 10.2.2.20</li>
<li>V3 - eth0: 10.2.2.30</li>
<li>V4 - eth0: 10.2.2.40</li>
</ul>
<p>Network C: (10.3.3.0/24, vmnet4)</p>
<ul>
<li>V4 - eth1: 10.3.3.40</li>
</ul>
<p>Remove all static routes we did previously on Vyatta and V[1-2,4]:</p>
<p>delete protocols static route
commit
save
show proto</p>
<p>Set up OSPF - define the networks on each router that that router share with another router:</p>
<p>ALL: set loopback interface IP to something unique and with a /32
ALL: set protocols ospf redistribute connected
V4: set protocols ospf area 0 10.2.2.0/24
V2: set protocols ospf area 0 10.2.2.0/24
V2: set protocols ospf area 0 10.1.1.0/24
Vyatta: set protocols ospf area 0 10.1.1.0/24
V3: set system gateway 10.2.2.20
V1: set system gateway 10.1.1.1</p>
<p>Test:</p>
<p>V4: ping 192.168.0.23
V4: show ip ospf route</p>
<p>Debug:</p>
<p>V2: monitor protocol ospf enable lsa
V4: reboot # and wait
V2: show log|less</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>