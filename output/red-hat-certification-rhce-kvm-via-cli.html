<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  Red Hat Certification - RHCE - KVM via CLI | There is IT in Helsinki
</title>
  <link rel="canonical" href="/red-hat-certification-rhce-kvm-via-cli.html">


  <link rel="stylesheet" href="/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="/theme/css/fontawesome.min.css">
  <link rel="stylesheet" href="/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="/theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="/atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="/it.atom.xml">  
  <meta name="description" content="In a previous post while preparing for RHCSA I installed kvm post-installation, via the GUI. But how to install, configure and use it only from the CLI? Virt-Manager http://virt-manager.org/page/Main_Page has some details As a test-machine I'm using a server with Scientific Linux 6.2 (with virtualization …">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="/">
        <img class="img-fluid rounded" src=/images/blog_site_image_small.webp alt="There is IT in Helsinki">
      </a>
    </div>
  <div class="col-sm-8">
    <h1 class="title"><a href="/">There is IT in Helsinki</a></h1>
      <ul class="list-inline">
          <li class="list-inline-item"><a href="/tags/" target="_blank">tags</a></li>
          <li class="list-inline-item"><a href="/categories/" target="_blank">categories</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fab fa-twitter" href="https://twitter.com/martbhell" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fas fa-rss" href="/atom.xml" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-github" href="https://github.com/martbhell" target="_blank"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  Red Hat Certification - RHCE - KVM via CLI
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2012-06-16T00:00:00+03:00">
          <i class="fas fa-clock"></i>
          2012-06-16
        </li>
        <li class="list-inline-item">
          <i class="fas fa-folder-open"></i>
          <a href="/category/it.html">it</a>
        </li>
          <li class="list-inline-item">
            <i class="fas fa-tag"></i>
              <a href="/tag/certification.html">#certification</a>,               <a href="/tag/kvm.html">#kvm</a>,               <a href="/tag/libvirt.html">#libvirt</a>,               <a href="/tag/libvirtd.html">#libvirtd</a>,               <a href="/tag/linux.html">#linux</a>,               <a href="/tag/qemu.html">#qemu</a>,               <a href="/tag/red.html">#red</a>,               <a href="/tag/hat.html">#hat</a>,               <a href="/tag/rhce.html">#rhce</a>,               <a href="/tag/scientific.html">#scientific</a>,               <a href="/tag/studying.html">#studying</a>,               <a href="/tag/virtualization.html">#virtualization</a>          </li>
      </ul>
    </header>
    <div class="content">
      <p>In a previous <a href="https://www.guldmyr.com/rhcsa-preparation/">post</a> while preparing for RHCSA I installed kvm post-installation, via the GUI.</p>
<p>But how to install, configure and use it only from the CLI?</p>
<h2 id="virt-manager">Virt-Manager</h2>
<p><a href="http://virt-manager.org/page/Main_Page">http://virt-manager.org/page/Main_Page</a> has some details</p>
<p>As a test-machine I'm using a server with Scientific Linux 6.2 (with virtualization enabled as seen by 'cat /proc/cpuinfo|grep vmx').</p>
<p>None of the Virtualization Groups are installed, as seen by 'yum grouplist'. While doing that you'll find four different groups. You can use</p>
<p>yum groupinfo "Virtualization Client"</p>
<p>or correspondingly to get more information about the group.</p>
<p>yum groupinstall Virtualization "Virtualization Tools" "Virtualization Platform" "Virtualization Client"</p>
<p>This installs a lot of things. Libvirt, virt-manager, qemu, gnome and python things.</p>
<p>lsmod|grep kvm
service libvirtd start
lsmod|grep kvm</p>
<p>This also sets up a bridge-interface (virbr0).</p>
<p>Now, how to install a machine or connect to the hypervisor?</p>
<p>How to get console?</p>
<p>ssh -XYC user@kvmserver
virt-manager</p>
<p>did not work.</p>
<p>On the <strong>client</strong> you could try to do:</p>
<p>yum groupinstall "Virtualization Client"
yum install libvirt
virt-manager</p>
<p>Then start virt-manager and connect to your server. However this didn't work for me either. Is virtualization needed on the client too?</p>
<p>Noit is not, first: check if Virtualization is enabled on the server. Look in /var/log/messages for</p>
<p>kernel: kvm: disabled by bios</p>
<p>If it says that you'll need to go into BIOS / Processor Options / and enable Virtualization.</p>
<p>Then you can start virt-manager, check that you can connect to the KVMserver.</p>
<p>Copy a .iso to /var/lib/libvirt/images on the server.</p>
<p>Re-connect to the kvm-server in virt-manager.</p>
<p>Add a new VM called <strong>test</strong>. Using 6.2 net-install and NAT network interface. This may take a while.</p>
<p>Pointing the VM to kvm-server where a httpd is running (remember firewall rules) and an SL 6.2 is stored. Installing a Basic Server.</p>
<p>OK, we could use virt-manager, it's quite straight-forward and doesn't require any edits of config files at all.</p>
<h2 id="moving-on-to-virsh">Moving on to <strong>virsh</strong>.</h2>
<p>To install a vm you use 'virt-install'.</p>
<p>You can get lots of info from 'virsh'</p>
<p>virsh pool-list
virsh vol-list default
virsh list
virsh list-all
virsh dumpxml test &gt; /tmp/test.xml
cp /tmp/test.xml /tmp/new.xml</p>
<p>Edit new.xml</p>
<p>change name to new and remove line with UUID</p>
<p>virt-xml-validate /tmp/new.xml
virsh help create
virsh create --file /tmp/new.xml
virsh list</p>
<p>This creates a new VM that uses the same disk and setup. But, if you shut down this new domain, it will disappear from virsh list --all and the list. To keep it you need to define it first:</p>
<p>virsh define --file /tmp/new.xml
virsh start new</p>
<p>This can become quite a bit more complicated. You would probably want to make clones (virt-clone) or snapshots (virsh help snapshot) instead of using the same disk file.</p>
<p>Making your own .xml from scratch looks fairly complicated. You could use 'virt-install' however.</p>
<p>virt-install --help
virt-install -n awesome -r 1024 --vcpus 1 --description=AWESOME --cdrom /var/lib/libvirt/images/CentOS-6.2-x86_64-netinstall.iso --os-type=linux --os-variant=rhel6 --disk path=/var/lib/libvirt/images/awesome,size=8 --hvm</p>
<p>For this the console actually works while running 'virt-install' over ssh on the kvm-server.</p>
<p>To make edit to a vm over ssh:</p>
<p>virsh edit NAMEOFVM</p>
    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
    <li class="list-inline-item"><a href="https://wtangy.se">Was There an NHL Game Yesterday?</a></li>
    <li class="list-inline-item"><a href="/tag/resepti">Recipes in Finnish</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>

</body>

</html>