<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  Raspberry Pi 4 with external SSDs | There is IT in Helsinki
</title>
  <link rel="canonical" href="/raspberry-pi-4-with-external-ssds.html">


  <link rel="stylesheet" href="/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="/theme/css/fontawesome.min.css">
  <link rel="stylesheet" href="/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="/theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="/atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="/it.atom.xml">  
  <meta name="description" content="Why This Exercise? Before this post I had an old mini-itx server with ssds at home. a 120GB, 4TB and a 2TB SSD all from Samsung, and one fourth 1TB now broken/missing one device that doesn't power on anymore :/. This really shouldn't have been an issue but I didn't â€¦">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="/">
        <img class="img-fluid rounded" src=/images/blog_site_image_small.webp alt="There is IT in Helsinki">
      </a>
    </div>
  <div class="col-sm-8">
    <h1 class="title"><a href="/">There is IT in Helsinki</a></h1>
      <ul class="list-inline">
          <li class="list-inline-item"><a href="/tags/" target="_blank">tags</a></li>
          <li class="list-inline-item"><a href="/categories/" target="_blank">categories</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fab fa-twitter" href="https://twitter.com/martbhell" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fas fa-rss" href="/atom.xml" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-github" href="https://github.com/martbhell" target="_blank"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  Raspberry Pi 4 with external SSDs
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2023-06-13T22:03:00+03:00">
          <i class="fas fa-clock"></i>
          2023-06-13
        </li>
        <li class="list-inline-item">
          <i class="fas fa-folder-open"></i>
          <a href="/category/it.html">it</a>
        </li>
          <li class="list-inline-item">
            <i class="fas fa-tag"></i>
              <a href="/tag/it.html">#it</a>,               <a href="/tag/ssd.html">#ssd</a>,               <a href="/tag/rpi.html">#rpi</a>,               <a href="/tag/raspberry-pi.html">#raspberry pi</a>,               <a href="/tag/raspberry-pi-4.html">#raspberry pi 4</a>,               <a href="/tag/sata.html">#sata</a>,               <a href="/tag/usb.html">#usb</a>          </li>
      </ul>
    </header>
    <div class="content">
      <h2 id="why-this-exercise">Why This Exercise?</h2>
<p>Before this post I had an old mini-itx server with ssds at home. </p>
<ul>
<li>a 120GB, 4TB and a 2TB SSD all from Samsung, and one fourth 1TB now broken/missing one device that doesn't power on anymore :/. </li>
</ul>
<p>This really shouldn't have been an issue but I didn't want to do RAID1 because the data wasn't that important to me and I had added them into an LVM RAID0 instead.</p>
<p>Fortunately I don't remember exactly what I did with the 1TB storage device, maybe I wasn't using it anymore but it was still part of the LVM VG? Anyway, files couldn't be read and there were some corrupted sqlites.</p>
<h2 id="what">What</h2>
<p>I first looked around for some cheap NAS boxes to put the SSDs in. No avail and definately not cheap.</p>
<p>Then I looked behind my monitor on my desk and saw an unused raspberry pi 4 with 8GB RAM.</p>
<p>Huh. Can I?</p>
<p>Insert research to find some good posts <a href="https://thepihut.com/blogs/raspberry-pi-tutorials/how-to-set-up-an-ssd-with-the-raspberry-pi">like this</a>  from thepihut.</p>
<p>It also had some link to a cable but unfortunately I couldn't order it. Maybe my card doesn't work outside EU?</p>
<h2 id="next">Next</h2>
<ul>
<li>before powering off the old server I vgexported the LVM</li>
<li>usb active plus right SATA to USB cables with controller? That RPI 4 likes.</li>
<li><a href="https://www.startech.com/en-us/hdd/usb312sat3cb">startech</a> had some overpowered 10Gb cables</li>
<li>firmware for the cable was not needed to update</li>
<li>Why was i Lazy with the lvm raid0 stripe lol of course first disk dies</li>
<li>always running out of more power extension at home, but now I think we're OK again</li>
<li>Got an Active USB hub from TPlink(TP-LINK UH720 active 7-port USB3.0) (needed because the RPi4 cannot power these disks)</li>
<li>Doesn't exactly match the 3.1 USB of the USB to SATA cables.</li>
</ul>
<h3 id="i-tried-to-recover-some-of-the-data-just-for-the-practice">I tried to recover some of the data just for the practice</h3>
<p>After plugging in both disks via the active hub:</p>
<ul>
<li><code>vgs</code> finds it!</li>
<li><code>vgchange -ay vg_data --activationmode partial</code><ul>
<li>1 LV activated!</li>
</ul>
</li>
<li><code>mount -t /dev/vg_data/lv_data /mnt/recovery -o ro</code><ul>
<li>works! And just tried to copy one image out and that worked woop! 2.8TB used with 3.4T free.</li>
<li>now what, get another 4TB disk and copy stuff there then juggle stuff around?</li>
<li>mount as rw and delete data until it's &lt; 2TB <ul>
<li>possibly risky?</li>
<li>did it anyway and it had "mounting fs with errors" in <code>dmesg</code> output</li>
<li>du has input/output errors to parts of this, but not the whole thing</li>
<li>started to delete stuff</li>
</ul>
</li>
<li>Make sure all data is on the 2TB PV sounds like a good idea</li>
<li>Remove 4TB PV from VG <code>vgsplit</code>  or <code>vgreduce</code><ul>
<li>tried vgreduce - wasn't happy </li>
<li>wanted a vgreduce with --removemissing but that complained about partial LVs in the VG</li>
<li>Maybe just easier to copy stuff out I want to save and then start from scratch?</li>
</ul>
</li>
<li>Create a new LVM with the 4TB then move stuff there</li>
<li>Then create another VG with the 2TB and put some other stuff there?</li>
</ul>
</li>
</ul>
<h2 id="in-the-end">In the end</h2>
<ul>
<li>Copied stuff out from the rpi4 into my desktop which had a few 100GB free on a disk.</li>
<li>Then wiped out the LVM on the two SSDs and created some new setup.</li>
</ul>
    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
    <li class="list-inline-item"><a href="https://wtangy.se">Was There an NHL Game Yesterday?</a></li>
    <li class="list-inline-item"><a href="/tag/resepti">Recipes in Finnish</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>

</body>

</html>