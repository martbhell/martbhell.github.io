<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  Simple RRD graphs | There is IT in Helsinki
</title>
  <link rel="canonical" href="/simple-rrd-graphs.html">


  <link rel="stylesheet" href="/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="/theme/css/fontawesome.min.css">
  <link rel="stylesheet" href="/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="/theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="/atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="/it.atom.xml">  
  <meta name="description" content="This is how to create simple RRD graphs using one data source that can be 0 and above. It is not an "ever increasing" counter. It will look like this: 1. Create the rrd database I wrote this down in a .sh file so I can go back later and â€¦">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="/">
        <img class="img-fluid rounded" src=/images/blog_site_image_small.webp alt="There is IT in Helsinki">
      </a>
    </div>
  <div class="col-sm-8">
    <h1 class="title"><a href="/">There is IT in Helsinki</a></h1>
      <ul class="list-inline">
          <li class="list-inline-item"><a href="/tags/" target="_blank">tags</a></li>
          <li class="list-inline-item"><a href="/categories/" target="_blank">categories</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fab fa-twitter" href="https://twitter.com/martbhell" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fas fa-rss" href="/atom.xml" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-github" href="https://github.com/martbhell" target="_blank"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  Simple RRD graphs
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2011-11-18T00:00:00+02:00">
          <i class="fas fa-clock"></i>
          2011-11-18
        </li>
        <li class="list-inline-item">
          <i class="fas fa-folder-open"></i>
          <a href="/category/it.html">it</a>
        </li>
          <li class="list-inline-item">
            <i class="fas fa-tag"></i>
              <a href="/tag/bash.html">#bash</a>,               <a href="/tag/dcache.html">#dcache</a>,               <a href="/tag/graph.html">#graph</a>,               <a href="/tag/graphs.html">#graphs</a>,               <a href="/tag/linux.html">#linux</a>,               <a href="/tag/monitoring.html">#monitoring</a>,               <a href="/tag/movers.html">#movers</a>,               <a href="/tag/plotting.html">#plotting</a>,               <a href="/tag/rrd.html">#rrd</a>,               <a href="/tag/rrdtool.html">#rrdtool</a>,               <a href="/tag/script.html">#script</a>,               <a href="/tag/statistics.html">#statistics</a>          </li>
      </ul>
    </header>
    <div class="content">
      <p>This is how to create simple RRD graphs using one data source that can be 0 and above. It is not an "ever increasing" counter.</p>
<p>It will look like this:</p>
<p><a href="images/movers.png"><img alt="example rrd graph" src="images/movers-300x96.png" title="movers"></a></p>
<h2 id="1-create-the-rrd-database">1. Create the rrd database</h2>
<p>I wrote this down in a .sh file so I can go back later and see how it was set up.</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh </span>
<span class="nv">rrdfile</span><span class="o">=</span><span class="s1">&#39;/home/$user/rrd/movers.rrd&#39;</span>
<span class="nv">rrdtool</span><span class="o">=</span><span class="s1">&#39;/usr/bin/rrdtool&#39;</span>
<span class="nv">$rrdtool</span><span class="w"> </span>create<span class="w"> </span><span class="nv">$rrdfile</span><span class="w"> </span>--step<span class="w"> </span><span class="m">300</span><span class="w"> </span>DS:movers:GAUGE:600:U:U<span class="w"> </span>RRA:AVERAGE:0.5:1:576<span class="w"> </span>RRA:AVERAGE:0.5:6:672<span class="w"> </span>RRA:AVERAGE:0.5:24:732<span class="w"> </span>RRA:AVERAGE:0.5:144:1460
</code></pre></div>

<ul>
<li>
<h1 id="5-minute-step-base-interval-with-which-data-will-be-fed-into-the-rrd">5 minute step (base interval with which data will be fed into the RRD)</h1>
</li>
<li>
<h1 id="10-minute-heartbeat-for-the-data-source-2-days-of-5-minute-averages">10 minute heartbeat for the data source #2 days of 5 minute averages</h1>
</li>
<li>
<h1 id="2-weeks-of-12-hour-averages">2 weeks of 1/2 hour averages</h1>
</li>
<li>
<h1 id="2-months-of-2-hour-averages">2 months of 2 hour averages</h1>
</li>
<li>
<h1 id="2-years-of-12-hour-averages">2 years of 12 hour averages</h1>
</li>
</ul>
<h2 id="2-add-data-to-the-rrd">2 Add data to the rrd</h2>
<p>Also done in a bash script. Because the --step above is set to 300, you need to run this script every 300 seconds (or every 5 minutes). The script specified in $allpools prints the path to a file. Then with $output and $movers that file is grepped for 'RUNNING' and then it counts how many lines that was - amount of movers.</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>
<span class="nv">rrdfile</span><span class="o">=</span><span class="s1">&#39;/home/$user/rrd/movers.rrd&#39;</span>
<span class="nv">rrdtool</span><span class="o">=</span><span class="s1">&#39;/usr/bin/rrdtool&#39;</span>

<span class="nv">allpools</span><span class="o">=</span><span class="s1">&#39;/home/$user/bash\_script.sh&#39;</span>
<span class="nv">output</span><span class="o">=</span><span class="k">$(</span><span class="nv">$allpools</span><span class="k">)</span>
<span class="nv">movers</span><span class="o">=</span><span class="k">$(</span>grep<span class="w"> </span>RUNNING<span class="w"> </span><span class="nv">$output</span><span class="p">|</span>wc<span class="w"> </span>-l<span class="k">)</span>

<span class="nv">$rrdtool</span><span class="w"> </span>update<span class="w"> </span><span class="nv">$rrdfile</span><span class="w"> </span>N:<span class="nv">$movers</span>
</code></pre></div>

<p>The N: is NOW. $movers is the value you want to plot.</p>
<h2 id="3-make-a-graph">3. Make a graph</h2>
<p>Add this to another .sh script. This you can run at whatever interval you want.</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>
<span class="nv">rrdfile</span><span class="o">=</span><span class="s1">&#39;movers.rrd&#39;</span>
<span class="nv">rrdtool</span><span class="o">=</span><span class="s1">&#39;/usr/bin/rrdtool&#39;</span>
<span class="nv">dpath</span><span class="o">=</span><span class="s2">&quot;/var/www/html/graphs/movers&quot;</span>
<span class="nv">alltimeimage</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$dpath</span><span class="s2">/movers.png&quot;</span>
<span class="nv">lastweekimage</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$dpath</span><span class="s2">/moverslw.png&quot;</span>
<span class="nv">lastmonthimage</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$dpath</span><span class="s2">/moverslm.png&quot;</span>
<span class="nv">last4hoursimage</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$dpath</span><span class="s2">/moversl4h.png&quot;</span>
<span class="nv">last3monthsimage</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$dpath</span><span class="s2">/moversl3m.png&quot;</span>
<span class="nv">lastday</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$dpath</span><span class="s2">/moversld.png&quot;</span>
<span class="nv">enddate</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span>
<span class="c1">#enddate is the same as &quot;now&quot;</span>
<span class="nb">cd</span><span class="w"> </span>/home/<span class="nv">$user</span>/rrd

<span class="nv">$rrdtool</span><span class="w"> </span>graph<span class="w"> </span><span class="nv">$alltimeimage</span><span class="w"> </span>--end<span class="w"> </span>now<span class="w"> </span>--start<span class="w"> </span><span class="m">1321603000</span><span class="w"> </span><span class="se">\\</span>
<span class="w">        </span>-v<span class="w"> </span>from<span class="se">\_</span>beginning<span class="w"> </span>-t<span class="w"> </span>active<span class="se">\_</span>movers<span class="w"> </span><span class="se">\\</span>
<span class="w">        </span>DEF:movers<span class="o">=</span><span class="nv">$rrdfile</span>:movers:AVERAGE<span class="w"> </span>LINE:movers#000000
<span class="c1">#rrdtool graph /path/to/image.png --end now --start when\_I\_started\_capturing -v label\_left -t title\_top \\</span>
<span class="c1">#DEF: as I only have one I only used movers, maybe you can change the names in case you have several data sources</span>
<span class="c1">#DEF: you can also use other things than AVERAGE (like MIN/MAX)</span>
<span class="c1">#LINE: #000000 is black</span>

<span class="nv">$rrdtool</span><span class="w"> </span>graph<span class="w"> </span><span class="nv">$lastweekimage</span><span class="w"> </span>--start<span class="w"> </span>-1w<span class="w"> </span><span class="se">\\</span>
<span class="w">        </span>-v<span class="w"> </span>last<span class="se">\_</span>week<span class="w"> </span>-t<span class="w"> </span>active<span class="se">\_</span>movers<span class="w"> </span><span class="se">\\</span>
<span class="w">        </span>DEF:movers<span class="o">=</span><span class="nv">$rrdfile</span>:movers:AVERAGE<span class="w"> </span>LINE:movers#000000<span class="w"> </span><span class="se">\\</span>
<span class="w">        </span>AREA:movers#8C2E64<span class="w"> </span><span class="se">\\</span>
<span class="w">        </span>GPRINT:movers:LAST:<span class="s2">&quot;Current\\: %1.0lf&quot;</span><span class="w"> </span><span class="se">\\</span>
<span class="w">        </span>GPRINT:movers:MAX:<span class="s2">&quot;Max\\: %1.0lf&quot;</span><span class="w"> </span><span class="se">\\</span>
<span class="w">        </span>GPRINT:movers:MIN:<span class="s2">&quot;Min\\: %1.0lf&quot;</span><span class="w"> </span><span class="se">\\</span>
<span class="w">        </span>GPRINT:movers:AVERAGE:<span class="s2">&quot;Avg\\: %1.0lf&quot;</span>

<span class="c1">#If you want to make it a little more complex. AREA fills the space between the value and the x-axis.</span>
<span class="c1">#GPRINT statements print some values relating to the graph.</span>

<span class="nv">$rrdtool</span><span class="w"> </span>graph<span class="w"> </span><span class="nv">$last4hoursimage</span><span class="w"> </span>--end<span class="w"> </span>now<span class="w"> </span>--start<span class="w"> </span>end-4h<span class="w"> </span><span class="se">\\</span>
<span class="w">        </span>-v<span class="w"> </span>last<span class="se">\_</span><span class="m">4</span><span class="se">\_</span>hours<span class="w"> </span>-t<span class="w"> </span>active<span class="se">\_</span>movers<span class="w"> </span><span class="se">\\</span>
<span class="w">        </span>DEF:movers<span class="o">=</span><span class="nv">$rrdfile</span>:movers:AVERAGE<span class="w"> </span>LINE:movers#000000

<span class="nv">$rrdtool</span><span class="w"> </span>graph<span class="w"> </span><span class="nv">$lastmonthimage</span><span class="w"> </span>--end<span class="w"> </span>now<span class="w"> </span>--start<span class="w"> </span>-1m<span class="w"> </span><span class="se">\\</span>
<span class="w">        </span>-v<span class="w"> </span>last<span class="se">\_</span>month<span class="w"> </span>-t<span class="w"> </span>active<span class="se">\_</span>movers<span class="w"> </span><span class="se">\\</span>
<span class="w">        </span>DEF:movers<span class="o">=</span><span class="nv">$rrdfile</span>:movers:AVERAGE<span class="w"> </span>LINE:movers#000000

<span class="nv">$rrdtool</span><span class="w"> </span>graph<span class="w"> </span><span class="nv">$last3monthsimage</span><span class="w"> </span>--end<span class="w"> </span>now<span class="w"> </span>--start<span class="w"> </span>-8035200<span class="w"> </span><span class="se">\\</span>
<span class="w">        </span>-v<span class="w"> </span>last<span class="se">\_</span><span class="m">3</span><span class="se">\_</span>months<span class="w"> </span>-t<span class="w"> </span>active<span class="se">\_</span>movers<span class="w"> </span><span class="se">\\</span>
<span class="w">        </span>DEF:movers<span class="o">=</span><span class="nv">$rrdfile</span>:movers:AVERAGE<span class="w"> </span>LINE:movers#000000

<span class="nv">$rrdtool</span><span class="w"> </span>graph<span class="w"> </span><span class="nv">$lastday</span><span class="w"> </span>--end<span class="w"> </span>now<span class="w"> </span>--start<span class="w"> </span>-1d<span class="w"> </span><span class="se">\\</span>
<span class="w">        </span>-v<span class="w"> </span>last<span class="se">\_</span>day<span class="w"> </span>-t<span class="w"> </span>active<span class="se">\_</span>movers<span class="w"> </span><span class="se">\\</span>
<span class="w">        </span>DEF:movers<span class="o">=</span><span class="nv">$rrdfile</span>:movers:AVERAGE<span class="w"> </span>LINE:movers#000000
</code></pre></div>

<h2 id="4-crontab-scheduling">4. Crontab - scheduling</h2>
<div class="highlight"><pre><span></span><code>\*/5 \* \* \* \* /bin/bash /home/$user/rrd/rrd.update.sh &gt; /dev/null 2&gt;&amp;1 #every 5 minutes \*/15 \* \* \* \* /bin/bash /home/$user/rrd/rrd.graph.sh &gt; /dev/null 2&gt;&amp;1 #every 15 minutes
</code></pre></div>

<h2 id="5-final-words">5. Final Words</h2>
<p>I am not providing the data gathering script here as you probably won't need it: it lists movers (transfers) on all pools in a dCache system.</p>
    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
    <li class="list-inline-item"><a href="https://wtangy.se">Was There an NHL Game Yesterday?</a></li>
    <li class="list-inline-item"><a href="/tag/resepti">Recipes in Finnish</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>

</body>

</html>