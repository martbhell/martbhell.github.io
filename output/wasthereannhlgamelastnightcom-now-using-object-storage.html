<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  wasthereannhlgamelastnight.com - now using object storage! | There is IT in Helsinki
</title>
  <link rel="canonical" href="/wasthereannhlgamelastnightcom-now-using-object-storage.html">


  <link rel="stylesheet" href="/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="/theme/css/fontawesome.min.css">
  <link rel="stylesheet" href="/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="/theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="/atom.xml">
  
  <meta name="description" content="To continue this series of blog posts about the awesome https://wasthereannhlgamelastnight.appspot.com/WINGS web site where you can see if there was in fact, an NHL game last night :) Some background: First I had a python script that scraped the website of nhl.com and later changed that …">
  <script>
    (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o);
      a.async = 1;
      a.src = g;
      m = s.getElementsByTagName(o)[0];
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'G-H4LG7R6ZGG', 'auto');
    ga('send', 'pageview');
  </script>


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
  <div class="col-sm-12">
    <h1 class="title"><a href="/">There is IT in Helsinki</a></h1>
      <ul class="list-inline">
          <li class="list-inline-item"><a href="/tags/" target="_blank">tags</a></li>
          <li class="list-inline-item"><a href="/categories/" target="_blank">categories</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fab fa-twitter" href="https://twitter.com/martbhell" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fas fa-rss" href="/atom.xml" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-github" href="https://github.com/martbhell" target="_blank"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  wasthereannhlgamelastnight.com - now using object storage!
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2017-10-07T00:00:00+03:00">
          <i class="fas fa-clock"></i>
          2017-10-07
        </li>
        <li class="list-inline-item">
          <i class="fas fa-folder-open"></i>
          <a href="/category/it.html">it</a>
        </li>
          <li class="list-inline-item">
            <i class="fas fa-tag"></i>
              <a href="/tag/cloud.html">#cloud</a>,               <a href="/tag/gcloud.html">#gcloud</a>,               <a href="/tag/google.html">#google</a>,               <a href="/tag/nhl.html">#nhl</a>,               <a href="/tag/programming.html">#programming</a>,               <a href="/tag/wasthereannhlgamelastnight.html">#wasthereannhlgamelastnight</a>          </li>
      </ul>
    </header>
    <div class="content">
      <p>To continue this series of blog posts about the awesome <a href="https://wasthereannhlgamelastnight.appspot.com/WINGS">https://wasthereannhlgamelastnight.appspot.com/WINGS</a> web site where you can see if there was in fact, an <a href="http://nhl.com/schedule">NHL</a> game last night :)</p>
<p>Some background: First I had a python script that scraped the website of nhl.com and later changed that to just grab the data from the JSON REST API of nhl.com - much nicer. But it was still outputing the result to stdout as a set and a dictionary. And then I would in the application import this file to get the schedule. This was quite hacky and ugly :) But hey it worked.</p>
<p>As of <a href="https://github.com/martbhell/wasthereannhlgamelastnight/commit/391c154670c4577c5d185937e56a340ff912810c">this commit</a> it now uses Google's <a href="https://cloud.google.com/storage/">Cloud Object Storage</a>:</p>
<ul>
<li>a special URL (one has to be an admin to be able to access it)</li>
<li>there's a cronjob which calls this URL once a day (22:00 in some time zone)</li>
<li>when this URL is called a <a href="https://github.com/martbhell/wasthereannhlgamelastnight/blob/master/src/update_schedule.py">python script</a> runs which:<ul>
<li>checks what year it is and composes the URL to the API so that we only grab this season's games (to be a bit nicer to the API)</li>
<li>does some sanity checking - that the fetched data is not empty</li>
<li>extracts the dates and teams as before and writes two variables,<ul>
<li>one list which has the dates when there's a game</li>
<li>one dictionary which has the dates and all the games on each date<ul>
<li>probably the last would be enough ;)</li>
</ul>
</li>
</ul>
</li>
<li>finally always overwrites the schedule</li>
</ul>
</li>
</ul>
<p>To only update it when there are changes would be cool as then I could notify myself (and possibly others) when there have been changes, but it would mean that the JSON dict has to be ordered, which they aren't by default so I'd have to change some stuff. The <a href="https://cloud.google.com/appengine/docs/standard/python/googlecloudstorageclient/gcsfilestat_class">GCSFileStat</a> has a checksum-like metadata of the files called <a href="https://en.wikipedia.org/wiki/HTTP_ETag">ETAG</a>. But probably it would be best to first compute a checksum of the generated JSON and then add that as an extra metadata to the object as this ETAG is probably implemented differently between providers.</p>
<p>http://www.guldmyr.com/blog/wasthereannhlgamelastnight-appspot-com-fixed-working-again/</p>
    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
    <li class="list-inline-item"><a href="https://wtangy.se">Was There an NHL Game Yesterday?</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>

</body>

</html>