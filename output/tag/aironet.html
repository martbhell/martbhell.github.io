<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>There is IT in Helsinki - aironet</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">There is IT in Helsinki</a></h1>
                <nav><ul>
                    <li><a href="/category/finland.html">finland</a></li>
                    <li><a href="/category/it.html">it</a></li>
                    <li><a href="/category/storage.html">storage</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/air-lap1142n-e-k9-to-autonomous-mode-adventure.html">"AIR-LAP1142N-E-K9 to autonomous Mode Adventure"</a></h1>
<footer class="post-info">
        <abbr class="published" title="2020-02-19T00:00:00+02:00">
                Published: "2020-02-19"
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/johan-guldmyr.html">Johan Guldmyr</a>
        </address>
<p>In <a href="/category/it.html">it</a>.</p>
<p>tags: <a href="/tag/aironet.html">aironet</a> <a href="/tag/cisco.html">cisco</a> <a href="/tag/ethernet.html">ethernet</a> <a href="/tag/https.html">https</a> <a href="/tag/ip.html">ip</a> <a href="/tag/lap1142n.html">lap1142n</a> <a href="/tag/e.html">e</a> <a href="/tag/k9.html">k9</a> <a href="/tag/network.html">network</a> <a href="/tag/vlan.html">vlan</a> <a href="/tag/wifi.html">wifi</a> <a href="/tag/wlan.html">wlan</a> </p>
</footer><!-- /.post-info --><blockquote>
<h2><a href="https://www.guldmyr.com/blog/wp-content/uploads/DSC_1469-scaled.jpg"><img alt="Wifi and PoE injector " src="images/DSC_1469-300x225.jpg"></a></h2>
</blockquote>
<h2>Some initial needful information</h2>
<ul>
<li>Reset is done by holding MODE and then powering off and on the device</li>
<li>Default enable password is Cisco</li>
<li>Serial ttyUSB0 worked with one usb to rs232 and then a serial to RJ45 adapter, my cheapo ebay USB to rj45 did not work. The colors of the wires are different..<ul>
<li>working: LL977744 CSA AWM and a "pl2303 converter" Prolific Technology Inc on ttyUSB0</li>
</ul>
</li>
<li>Firmware c1140-k9w7-tar.153-3.JD17.tar found on twitter with checksum d96702caf75442f01359aa9a6cb70d19</li>
</ul>
<p>While the AP is in non autonomous mode you need to run a debug command to get the conf t: <em>debug capwap console cli</em></p>
<p>To change it from using a controller to autonomous mode you need to load a firmware that is like that. The one I got had a firmware loaded that wanted to talk to a controller.</p>
<ul>
<li>While looking in serial log indeed the firmware on the AP was "w8" at the end == needs a WLC</li>
<li>tried to first setup a TFTP server and open firewalls and reboot the access point while holding the mode button (you need to hold it for a long time, like 27s) - it tried to fetch the image from tftp://255.255.255.255/ but didn't work / timed out..</li>
</ul>
<h2>Hunt goes on:</h2>
<p>These release notes got me a bit worried: <a href="https://www.cisco.com/c/en/us/td/docs/wireless/access_point/ios/release/notes/aap-rn-83mr5.html">https://www.cisco.com/c/en/us/td/docs/wireless/access_point/ios/release/notes/aap-rn-83mr5.html</a></p>
<p>Conversions from an 8.0 Wireless LAN Controller unified release AP image to autonomous 15.3(3) k9w7 image will get aborted with a message “AP image integrity check failed.” To overcome this, load any previous autonomous k9w7 image and then upgrade to the 15.3(3) JAB k9w7 images. <strong>If this is the same as LWAPP version I had was 7.3.x</strong> <em>so the above did not apply.</em></p>
<p><a href="https://greenwhitehat.blogspot.com/2017/08/how-to-configure-cisco-access-point-air.html">https://greenwhitehat.blogspot.com/2017/08/how-to-configure-cisco-access-point-air.html</a></p>
<p><a href="https://www.fragmentationneeded.net/2010/08/tftp-oddities.html">https://www.fragmentationneeded.net/2010/08/tftp-oddities.html</a> is talking about changing listening address to 255.255.255.255 instead of 0.0.0.0 ..</p>
<h2>secret sauze</h2>
<ul>
<li>setup static IP on your linux computer, <strong><em>make sure to not just "ip addr add ip/24 dev eth0" because you might still have NetworkManager with DHCP that might revert those changes</em></strong></li>
<li>setup a dhcpd that has 10.0.0.5 10.0.0.7 range or some such</li>
<li>setup a linux tftp.service - if you want "--verbose --address 255.255.255.255:69" to the tftp.service CentOS7 edit that file in systemctl cat tftp<ul>
<li>Not sure if needed but maybe it was useful</li>
</ul>
</li>
<li>systemctl start tftp dhcpd</li>
<li>sysetmctl disable dhcpd tftp</li>
<li>make sure to let UDP(&amp; TCP?) 69 through the firewall</li>
<li>next is to connect the console and login to the AP and run some commands:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">$</span><span class="w"> </span><span class="n">ena</span>
<span class="c1"># conf t</span>
<span class="c1"># debug capwap console cli</span>
<span class="c1"># archive download-sw /force-reload /overwrite tftp://10.0.0.2/c1140-k9w7-tar.153-3.JD17.tar</span>
</code></pre></div>

<ul>
<li><em>Before you disconnect the ethernet cable to the AP, do stop and disable dhcpd and tftp to prevent running some extra dhcp server in some office network.</em></li>
</ul>
<h2>Configuring it</h2>
<p>Easiest is probably to use the http on http://IP:80 to configure it</p>
<p>Username/Password: Cisco/Cisco</p>
<p><a href="https://www.cisco.com/c/en/us/td/docs/wireless/access_point/1140/autonomous/getting_started/guide/ap1140aut_getstart.html">https://www.cisco.com/c/en/us/td/docs/wireless/access_point/1140/autonomous/getting_starte d/guide/ap1140aut_getstart.html</a></p>
<p>There's the express setup and I used these settings:</p>
<ul>
<li>Only configured the 5GHz</li>
<li>Set a short SSID and enabled broadcast beacon</li>
<li>WPA2-PSK key</li>
<li>Disabled universal admin</li>
<li>Set VLAN 5 and native VLAN</li>
</ul>
<p>Other changes:</p>
<ul>
<li>Enable the radio (no shutdown on the interface or in the web ui)</li>
<li>Create a new user/change default passwords of Cisco user to make it a little bit harder for things to pwn it</li>
<li>Set clock</li>
<li>Change hostname and set a banner login banner</li>
<li>copy run start</li>
</ul>
<p>One could enable https, but that used a too weak key by default so I just left it at http. In any case make sure to set the clock before enabling https.</p>
<h2>Some extremely useful links</h2>
<p>Previous post in this blog about my home network: <a href="https://www.guldmyr.com/blog/home-network-convergence/">https://www.guldmyr.com/blog/home-network-convergence/</a></p>
<p><a href="https://community.cisco.com/t5/wireless-mobility-documents/lwapp-to-autonomous-conversion-and-vice-versa-on-access-points/ta-p/3121542">https://community.cisco.com/t5/wireless-mobility-documents/lwapp-to-autonomous-conversion-and-vice-versa-on-access-points/ta-p/3121542</a></p>
<p><a href="http://wiki.r1soft.com/display/ServerBackup/Configure+a+TFTP+server+on+Linux">http://wiki.r1soft.com/display/ServerBackup/Configure+a+TFTP+server+on+Linux</a></p>
<p><a href="http://exchange2013pikasuoh.blogspot.com/2015/08/convert-cisco-air-lap1142n-k9-to.html">http://exchange2013pikasuoh.blogspot.com/2015/08/convert-cisco-air-lap1142n-k9-to.html</a></p>                </article>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>